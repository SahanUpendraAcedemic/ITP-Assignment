export const semaphore = (limit = 1, count = 0, rs = new Array(), all) => ({
    acquire: () => ++count > limit && new Promise((resolve) => rs.push(resolve)),
    release: () => (--count ? rs.shift()?.() : all?.()),
    all: () => count && new Promise((resolve) => (all = resolve)),
});
